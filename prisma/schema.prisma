generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

model Employee {
  id                   String                     @id @default(cuid())
  name                 String
  email                String?                    @unique
  phone                String?
  cpf                  String?                    @unique
  address              String?
  dept                 String
  role                 String
  hourlyRate           Float                      @default(0.0)
  avatar               String?
  pin                  String                     @unique // 6-digit PIN
  hoursBalance         Float                      @default(0.0) // Banco de horas em horas
  records              DailyRecord[]
  corrections          CorrectionRequest[]
  justifications       JustificationRequest[]
  notifications        EmployeeNotification[]
  timeOffs             TimeOff[]
  overtimes            Overtime[]
  weeklyOffDays        EmployeeWeeklyOffDay[]
  createdAt            DateTime                   @default(now())
  updatedAt            DateTime                   @updatedAt
}

model DailyRecord {
  id             String    @id @default(cuid())
  employeeId     String
  employee       Employee  @relation(fields: [employeeId], references: [id])
  date           String    // YYYY-MM-DD
  entry          DateTime?
  lunchStart     DateTime?
  lunchEnd       DateTime?
  exit           DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@unique([employeeId, date])
}

model Admin {
  id             String    @id @default(cuid())
  username       String    @unique
  password       String
  name           String?
  createdAt      DateTime  @default(now())
}

model Notice {
  id             String    @id @default(cuid())
  title          String
  content        String
  type           String    @default("info") // info, warning, urgent
  active         Boolean   @default(true)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model CorrectionRequest {
  id             String    @id @default(cuid())
  employeeId     String
  employee       Employee  @relation(fields: [employeeId], references: [id])
  date           String    // Data do ponto a corrigir
  type           String    // entry, lunchStart, lunchEnd, exit
  requestedTime  String    // Horário solicitado
  reason         String
  status         String    @default("pending") // pending, approved, rejected
  adminComment   String?   // Comentário do admin ao negar
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model JustificationRequest {
  id             String    @id @default(cuid())
  employeeId     String
  employee       Employee  @relation(fields: [employeeId], references: [id])
  date           String    // Data da ausência
  reason         String
  status         String    @default("pending") // pending, approved, rejected
  adminComment   String?   // Comentário do admin ao negar
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model EmployeeNotification {
  id             String    @id @default(cuid())
  employeeId     String
  employee       Employee  @relation(fields: [employeeId], references: [id])
  title          String
  message        String
  type           String    @default("info") // info, success, warning, error
  read           Boolean   @default(false)
  createdAt      DateTime  @default(now())
}

model TimeOff {
  id             String    @id @default(cuid())
  employeeId     String
  employee       Employee  @relation(fields: [employeeId], references: [id])
  startDate      String    // YYYY-MM-DD
  endDate        String    // YYYY-MM-DD
  type           String    // vacation, sick, personal, medical
  reason         String?
  status         String    @default("approved") // pending, approved, rejected
  approvedBy     String?   // Admin que aprovou
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model Overtime {
  id             String    @id @default(cuid())
  employeeId     String
  employee       Employee  @relation(fields: [employeeId], references: [id])
  date           String    // YYYY-MM-DD
  hours          Float     // Horas extras trabalhadas
  reason         String
  status         String    @default("pending") // pending, approved, rejected
  adminComment   String?
  approvedBy     String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model EmployeeWeeklyOffDay {
  id             String    @id @default(cuid())
  employeeId     String
  employee       Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  dayOfWeek      Int       // 0-6 (Sunday=0, Monday=1, ..., Saturday=6)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@unique([employeeId, dayOfWeek])
}
